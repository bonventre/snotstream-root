<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
  <head> 
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /> 
    <title>Ostrich</title>
    <script src="js/json2.js"></script>
    <script src="js/jquery-1.7.js"></script> 
    <script src="js/jquery.jqplot.js"></script>
    <script src="js/plugins/jqplot.canvasTextRenderer.min.js"></script>
    <script src="js/plugins/jqplot.canvasAxisLabelRenderer.min.js"></script>
    <script type="text/javascript" src="js/plugins/jqplot.barRenderer.min.js"></script>
    <link type="text/css" rel="stylesheet" href="css/style.css">
    <link type="text/css" rel="stylesheet" href="http://fonts.googleapis.com/css?family=Droid+Sans"/> 
    <link rel="shortcut icon" href="images/favicon.ico"/>
    <style>
      .vmenu{border:1px solid #aaa;position:absolute;background:#fff; display:none;font-size:0.75em;}
      .vmenu .first_li span{width:100px;display:block;padding:5px 10px;cursor:pointer}
      .vmenu .inner_li{display:none;margin-left:120px;position:absolute;border:1px solid #aaa;
        border-left:1px solid #ccc;margin-top:-28px;background:#fff;}
      .vmenu .sep_li{border-top: 1px ridge #aaa;margin:5px 0}
      .vmenu .fill_title{font-size:11px;font-weight:bold;/height:15px;/overflow:hidden;word-wrap:break-word;}
    </style>
  </head>

  <body>
    <div id="header"></div>
    <br/>

    <div id="content">
      <div id="chartdiv" style="margin:50px;height:400px;width:300px; "></div>
      <div class="vmenu">
        <div class="first_li"><span>Clear</span></div>
        <div class="sep_li"></div>
        <div class="first_li"><span>Stop</span></div>
        <div class="sep_li"></div>
        <div class="first_li"><span>Load 5</span></div>
        <div class="first_li"><span>Load 10</span></div>
      </div>

    </div>

    <div id="footer"></div>
  </body>

  <script>
    $(document).ready(function() {
      $("#header").load("header.html");
      $("#footer").load("footer.html");

      $('#chartdiv').bind('contextmenu',function(e){
        var $cmenu = $(this).next();
        $('<div class="overlay"></div>').css({left:'0px',top:'0px',position:'absolute',width:'100%',height:'100%',zIndex:'100'}).click(function(){
        $(this).remove();
        $cmenu.hide();
      }).bind('contextmenu',function(){return false;}).appendTo(document.body);
      $(this).next().css({left: e.pageX, top: e.pageY, zIndex: '101'}).show();
      return false;
    });

    $('.vmenu .first_li').live('click',function(){
      if ($(this).text() == "Stop"){
        stop = 1;
        $(this).html("<span>Start</span>");
        }else if ($(this).text() == "Clear"){
        for (var i=0;i<5;i++){
          plot2.series[0].data[i][1] = 0;
          plot2.series[1].data[i][1] = 0;
        }
        plot2.replot({resetAxes:true});
        }else if ($(this).text() == "Load 5"){
        clearTimeout(t);
        update(5);
        t = setTimeout(timer,500);
        }else if ($(this).text() == "Load 10"){
        clearTimeout(t);
        update(10);
        t = setTimeout(timer,500);
        }else{
        $(this).html("<span>Stop</span>");
        stop = 0;
        clearTimeout(t);
        timer(1);
      }

      $('.vmenu').hide();
      $('.overlay').hide();
    });

    var ajaxDataRenderer = function(url, plot, options){
      var ret = null;
      $.ajax({
        async: false,
        url: url,
        dataType:"json",
        success: function(data){
          ret = data;
        }
      });
      return ret;
    }

    var jsonurl = "./data"
    /*

    var plot2 = $.jqplot('chartdiv',jsonurl,{
      title: "AJAX JSON Data Renderer",
      dataRenderer: ajaxDataRenderer,
      dataRendererOptions: {
        unusedOptionalUrl: jsonurl
      }
    });
    */
    var summed = [0,0,0,0,0];
    var adding = [0,0,0,0,0];
    var stop = 0;
    var plot2 = $.jqplot('chartdiv',[summed,adding],{
      stackSeries: true,
      seriesDefaults:{
        renderer:$.jqplot.BarRenderer,
        rendererOptions: {
          barMargin: 10,
        },
        pointLabels: {show: true}
      },
      axes: {
        xaxis: {
          renderer: $.jqplot.CategoryAxisRenderer
        },
        yaxis: {
          padMin: 0
        }
      }
    });

    console.log(plot2.series[0].data);
    console.log(plot2.series);

    function update(howmany) {
      var tempurl = jsonurl;
      if (howmany > 1)
      tempurl += "?prev=" + howmany;
      for (var i=0;i<4;i++){
        plot2.series[0].data[i][1] += plot2.series[1].data[i][1];
      }
      $.ajax({
        async: false,
        url: tempurl,
        dataType:"json",
        success: function(data){
          plot2.series[1].data = data;
        }
      });
      plot2.replot({resetAxes:true});
    }

    function timer(howmany){
      if (stop == 1){
        return;
      }
      update(howmany);
      t = setTimeout(timer,500);
    }

    timer(1);

    /*
    var plot0 = $.jqplot('chartdiv',  [[[1, 2],[3,5.12],[5,13.1],[7,33.6],[9,85.9],[11,219.9]]],{
      axes:{
        xaxis:{
          label:'Angle (radians)',
          labelRenderer: $.jqplot.CanvasAxisLabelRenderer
        },
        yaxis:{
          label:'Cosine',
          labelRenderer: $.jqplot.CanvasAxisLabelRenderer
        }
      }

    });
    var i = 0;

    function update() {
      if (i%2 == 0){
        plot0.series[0].data = [[0,0],[1,1],[2,-1],[3,3]];
        plot0.replot({resetAxes:true});
        i++;
        }else{
        plot0.series[0].data = [[0,0],[1,-1],[2,2],[3,0]];
        plot0.replot({resetAxes:true});
        i=0;
      }
      setTimeout(update, 500);
    }

    update();
    */


  });
</script>
</html>

